# AIミニカーアノテーションツール

このツールは、自動運転と物体検知データセットのためのアノテーションを作成・管理するためのグラフィカルインターフェースを提供します。DonkeycarやJetracerなどのAIミニカー向けに設計されており、以下のことが可能です：

1. 画像データセットの読み込み
2. 運転アノテーション（ステアリング角度とスロットル）の作成
3. 物体検知アノテーション（バウンディングボックス）の作成
4. 画像への位置情報の割り当て
5. モデルのトレーニングと評価
6. 様々な形式でのアノテーションのエクスポート

## 機能

### アノテーション機能
- **運転制御**: ステアリング角度とスロットルのアノテーション
- **物体検知**: オブジェクト（車、人、標識、コーンなど）のバウンディングボックス作成
- **位置タグ付け**: 画像に位置識別子を割り当て
- **バッチ操作**: 自動アノテーション、範囲削除など

### トレーニングと推論
- **モデルトレーニング**: 運転制御用のニューラルネットワークをトレーニング
- **YOLO統合**: 物体検知用のYOLOモデルのトレーニングと使用
- **データ拡張**: 拡張によるトレーニングデータの強化
- **推論プレビュー**: 画像上でのモデル予測の表示

### エクスポートオプション
- **Donkeycar形式**: Donkeycar用のアノテーションをエクスポート
- **Jetracer形式**: Jetracer用のアノテーションをエクスポート
- **YOLO形式**: YOLO用のアノテーションをエクスポート
- **アノテーション動画**: アノテーションを可視化した動画の作成

### 高度な機能
- **実験追跡**: モデルパフォーマンス追跡のためのMLflow統合
- **セッション管理**: アノテーションセッションの保存と復元
- **拡張プレビュー**: トレーニング前に拡張効果を確認

## 要件

- Python 3.7以上
- PyQt5
- PyTorch
- Pillow
- NumPy
- MLflow (オプション、実験追跡用)
- Ultralytics (YOLOサポート用)

詳細なバージョン要件については、requirements.txtを参照してください。

## インストール

1. リポジトリをクローンします:
```bash
git clone <repository-url>
cd minicar-annotation-tool
```

2. 必要なパッケージをインストールします:
```bash
pip install -r requirements.txt
```

3. ツールを実行します:
```bash
python annotation_bbox.py
```

## 使用ガイド

### 基本的なワークフロー

1. **画像の読み込み**: 「参照」をクリックして画像フォルダを選択し、「画像を読込」をクリック
2. **アノテーションモードの選択**: 「自動運転」または「物体検知」モードを選択
3. **アノテーションの作成**:
   - 運転モードでは、画像をクリックしてステアリングとスロットル値を設定
   - 物体検知モードでは、クリック＆ドラッグでバウンディングボックスを作成
4. **位置の割り当て**: 右側の位置ボタンを使用して、画像に位置IDをタグ付け
5. **保存とエクスポート**: エクスポートボタンを使用して、希望の形式でアノテーションを保存

### キーボードショートカット

- **Bキー**: 運転モードと物体検知モードの切り替え
- **左/右矢印キー**: 10枚前後に移動
- **Delete/Backspace**: 選択したバウンディングボックスを削除

### モデルのトレーニング

1. ドロップダウンからモデルタイプを選択
2. 「学習・保存」をクリックしてトレーニングパラメータを設定
3. エポック数、学習率、データ拡張などの設定を調整
4. トレーニングを開始し、進捗を監視
5. MLflow（有効な場合）で結果を表示

### 自動アノテーション

1. 数枚の画像を手動でアノテーション
2. ドロップダウンからモデルを選択（またはデフォルトを使用）
3. 「オートアノテーション実行」をクリックして残りの画像を自動的にアノテーション

## フォルダ構造

ツールは以下のディレクトリを作成します:
- `annotation/`: すべてのアノテーションデータのメインディレクトリ
- `annotation/data_donkey/`: Donkeycarエクスポートファイル用
- `annotation/data_jetracer/`: Jetracerエクスポートファイル用
- `models/`: 保存されたトレーニング済みモデル用
- `mlruns/`: MLflow実験追跡データ用

## トラブルシューティング

### 一般的な問題

1. **CUDA/GPUエラー**: PyTorch用の互換性のあるCUDAドライバがインストールされていることを確認
2. **画像読み込みの問題**: 画像形式の互換性を確認（JPG、PNG、BMPがサポートされています）
3. **MLflowエラー**: MLflowはオプションです。問題が発生した場合は、その機能を無効にできます

### エラー報告

バグが見つかった場合は、以下の情報を含む問題を開いてください:
- エラーメッセージ
- 再現手順
- オペレーティングシステムとPythonバージョン

## ライセンス

[MITライセンス](LICENSE)

## 謝辞

このツールは、DonkeycarやJetracerなどのAIミニカープロジェクトをサポートするために開発されました。
